---
name: skill-builder
description: >
  スキル・ルール・規約の設計・追記・編集を支援する。
  既存スキルがあれば編集、なければ新規作成。
  ルール化すべきか判定し、適切な配置先（CLAUDE.md / *_RULES.md / Skills / 自動メモリ）を提案する。
  「これルール化すべき？」「スキル作りたい」「CLAUDE.mdに追加したい」「スキル修正して」と言われた時に使用する。
argument-hint: "[ルール化したい内容の説明]"
---

## 目的

Claude Code のプロジェクトルール・スキルを設計・追記・編集するためのメタスキル。
品質の高いルール・スキルを一貫した方法論で管理する。

---

## ワークフロー

### 0. 既存スキル・ルールの確認（最初に必ず実行）

要望に関連するスキル・ルールが既に存在するか確認する：

- `~/.claude/plugins/local/wp-toolkit/skills/` （WP系スキル・プラグイン）
- `~/.claude/skills/` （個人スキル）
- `.claude/skills/` （プロジェクトスキル）
- `CLAUDE.md` / `*_RULES.md`

**既に存在する場合 → 新規作成せず、既存を編集・追記する。**

| 状況 | アクション |
|------|-----------|
| 該当スキルが既にある | 既存 SKILL.md に追記・修正 |
| 関連するスキルに含めるべき内容 | 既存スキルのセクションに統合 |
| 既存ルールファイルに追加すべき | `*_RULES.md` や `CLAUDE.md` に追記 |
| どこにも該当しない | → ステップ1へ（新規作成フロー） |

### 1. ルール化すべきか判定（新規の場合）

ユーザーの要望を以下の基準で評価する：

**良い候補**
- 毎セッションで同じ説明を繰り返している
- AI が同じミスを何度もする
- チーム全員に守らせたい規約
- 間違えた場合のコストが高い
- 出力フォーマットが厳密に決まっている

**悪い候補**
- 一回限りの作業指示
- 文脈依存で汎用化できない
- Claude が既に知っている一般知識

**判定結果を出力:**
- MUST: 事故防止・セキュリティ → 即ルール化
- SHOULD: 品質向上・効率化 → ルール化推奨
- SKIP: 汎用知識・一回限り → 不要（理由を説明）

### 2. 配置先を決定

```
繰り返し実行するタスク？
├─ YES → Skills（下記スコープ判断へ）
└─ NO
   ├─ 毎セッション必要な最重要ルール？
   │   └─ YES → CLAUDE.md に直接記述（簡潔に）
   ├─ 特定ドメインの詳細ルール？
   │   └─ YES → *_RULES.md（CLAUDE.md から参照）
   ├─ セッション横断の学習記録？
   │   └─ YES → 自動メモリ（memory/*.md）
   └─ 外部ツール連携？
       └─ YES → MCP設定
```

### 2-B. スキルのスコープ判断

Skills の場合、配置先を判断する。
**おすすめを提案した上で、ユーザーに確認すること。**

判断基準：

| 条件 | おすすめ | 配置先 | Git リポジトリ |
|------|---------|--------|---------------|
| WordPress 関連 | WP Toolkit プラグイン | `~/.claude/plugins/local/wp-toolkit/skills/<name>/SKILL.md` | `dai-works/wp-toolkit` |
| WP以外で他案件でも使う | 個人スキル | `~/.claude/skills/<name>/SKILL.md` | `KoseiDaimon/skills` |
| このプロジェクト固有 | プロジェクトスキル | `.claude/skills/<name>/SKILL.md`（プロジェクトGit管理下） | プロジェクトリポジトリ |

提案の例：
> 「これは WordPress 関連なので、wp-toolkit プラグイン（`~/.claude/plugins/local/wp-toolkit/skills/`）に配置しますが、よいですか？」

**共有スキル（WP Toolkit / 個人）の汎用化ポイント:**
- パス: プロジェクト固有値を埋め込まず、作業ディレクトリから自動推定
- サポートファイル: スキルディレクトリ内に同梱し、`docker compose cp` 等で転送
- 命名: プロジェクト名を含めない（`suntrinity-test-post` ではなく `test-post`）

### 3. 設計・記述

配置先に応じたフォーマットで起草する。

### 4. 検証

- 既存ルールとの矛盾がないか確認
- 配置先ファイルが肥大化しないか確認

### 5. Git コミット＆プッシュ

スキル作成・編集後、対象リポジトリに commit & push する。

| 配置先 | ディレクトリ | リモート |
|--------|------------|---------|
| WP Toolkit | `~/.claude/plugins/local/wp-toolkit/` | `origin`（dai-works/wp-toolkit） |
| 個人スキル | `~/.claude/skills/` | `origin`（KoseiDaimon/skills） |
| プロジェクト | `.claude/skills/` | プロジェクトのリモート |

手順：
1. 対象ディレクトリで `git add` → `git commit` → `git push`
2. コミットメッセージ: `feat: add <skill-name>` または `fix: update <skill-name>`

---

## Skills の設計ガイドライン

### SKILL.md テンプレート

```yaml
---
name: kebab-case-name
description: >
  何をするか。いつ発動すべきか。
  ユーザーが使いそうな言い回しのバリエーションを含める。
# disable-model-invocation は設定しない（全スキル自動判定）
argument-hint: "[引数の説明]"   # 引数がある場合
---

## 目的
（1行で）

## ワークフロー / ルール
（本体）

## アンチパターン
（やってはいけないこと）
```

### description の書き方（最重要）

description が曖昧だとスキルが発動しない。

```yaml
# 悪い例
description: ドキュメントを作成する

# 良い例
description: >
  Word文書を変更履歴付きで作成・編集する。
  「ドキュメント作って」「Wordで書いて」「レビュー用の文書を」と言われた時に使用する。
```

### スキルの2タイプ

| タイプ | 用途 |
|--------|------|
| Reference | 背景知識（規約、パターン） |
| Task | 具体的な手順（生成、デプロイ等） |

**全スキル自動判定とする。** `disable-model-invocation` は設定しない。
description の質でトリガー精度を制御する。

### サポートファイル

SKILL.md が長くなる場合、同ディレクトリに分離：

```
.claude/skills/my-skill/
├── SKILL.md        # メイン指示（500行以下）
├── reference.md    # 詳細資料
└── examples.md     # 使用例
```

---

## CLAUDE.md / *_RULES.md の記述ガイドライン

### 記述ルール

1. **最重要ルールを最上部に置く**（Claude は上部をより重視する）
2. **説明より例を優先**
3. **MUST / SHOULD / MAY で強度を明示**
4. **アンチパターンを `❌` / `✅` で視覚的に区別**
5. **Claude が既に知っていることは書かない**

### *_RULES.md の構造テンプレート

```markdown
# [ドメイン名] ルール

（冒頭に目的を1行）

---

## クイックリファレンス
### MUST（絶対）
### SHOULD（推奨）

---

## 詳細ルール
### [カテゴリ1]
### [カテゴリ2]
```

### タスク性質別の章構成

| タスクの性質 | 重点セクション |
|------------|--------------|
| 厳密作業（コーディング規約） | MUST ルール、アンチパターン、チェックリスト |
| 創造的作業（デザイン実装） | 制約、スタイルガイド、参考例 |
| 分析・判断（コードレビュー） | ワークフロー、判断基準、出力フォーマット |

---

## アンチパターン（ルール設計全般）

- 長文で説明する → 例で示す
- 一般知識を書く → Claude は知っている
- 曖昧な表現（「適切に」「必要に応じて」）→ 具体的な条件を書く
- 相反するルールの併記 → 優先度を明記
- CLAUDE.md の肥大化 → 分離ファイルへ
- description にトリガー条件を書かない → 発動しなくなる
- 1つのスキルに複数の責務を詰め込む → 分割する

---

## チェックリスト

- [ ] 本当にルール化が必要か
- [ ] 配置先は適切か（個人 vs プロジェクト）
- [ ] 最重要ルールが上部にあるか
- [ ] 例示があるか
- [ ] アンチパターンを含むか
- [ ] 既存ルールと矛盾しないか
- [ ] CLAUDE.md / SKILL.md が肥大化していないか
- [ ] description にトリガー条件が含まれているか（Skills の場合）
